function ft=fet3d(q1,q2,q3,n,meltyp) % shape function derivative wrt xiif(meltyp==10) 		  switch n    case 1      ft=((-2.0)*(1.0-q1-q2-q3))+...          ((1.0-2.0*q1-2.0*q2-2.0*q3)*(-1.0));	    case 2      ft=0.0;    case 3      ft=((2.0)*q2)+((2.0*q2-1.0)*1.0);    case 4      ft=0.0;    case 5       ft=4.0*q1*(-1.0);		    case 6       ft=4.0*q2*(-1.0);	    case 7       ft=4.0*q3*(-1.0);    case 8       ft=4.0*q1*(1.0);    case 9       ft=4.0*(1.0)*q3;    case 10       ft=0.0;           endendif(meltyp==27) 		  	switch n        case 1           ft = (1.0-2.0*q1)*(1.0-q1)*(-2.0)*(1.0-q2)*(1.0-2.0*q3)*(1.0-q3)+...               (1.0-2.0*q1)*(1.0-q1)*(1.0-2.0*q2)*(-1.0)*(1.0-2.0*q3)*(1.0-q3);        case 2           ft = -(1.0-2.0*q1)*q1*(-2.0)*(1.0-q2)*(1.0-2.0*q3)*(1.0-q3)+...               -(1.0-2.0*q1)*q1*(1.0-2.0*q2)*(-1.0)*(1.0-2.0*q3)*(1.0-q3);        case 3           ft = (1.0-2.0*q1)*q1*(-2.0)*q2*(1.0-2.0*q3)*(1.0-q3)+...               (1.0-2.0*q1)*q1*(1.0-2.0*q2)*(1.0)*(1.0-2.0*q3)*(1.0-q3);        case 4           ft = -(1.0-2.0*q1)*(1.0-q1)*(-2.0)*q2*(1.0-2.0*q3)*(1.0-q3)+...               -(1.0-2.0*q1)*(1.0-q1)*(1.0-2.0*q2)*(1.0)*(1.0-2.0*q3)*(1.0-q3);        case 5           ft = -(1.0-2.0*q1)*(1.0-q1)*(-2.0)*(1.0-q2)*(1.0-2.0*q3)*q3+...               -(1.0-2.0*q1)*(1.0-q1)*(1.0-2.0*q2)*(-1.0)*(1.0-2.0*q3)*q3;        case 6           ft = (1.0-2.0*q1)*q1*(-2.0)*(1.0-q2)*(1.0-2.0*q3)*q3+...               (1.0-2.0*q1)*q1*(1.0-2.0*q2)*(-1.0)*(1.0-2.0*q3)*q3;        case 7           ft = -(1.0-2.0*q1)*q1*(-2.0)*q2*(1.0-2.0*q3)*q3+...               -(1.0-2.0*q1)*q1*(1.0-2.0*q2)*(1.0)*(1.0-2.0*q3)*q3;        case 8           ft = (1.0-2.0*q1)*(1.0-q1)*(-2.0)*q2*(1.0-2.0*q3)*q3+...               (1.0-2.0*q1)*(1.0-q1)*(1.0-2.0*q2)*(1.0)*(1.0-2.0*q3)*q3;        case 9           ft = 4.0*q1*(1.0-q1)*(-2.0)*(1.0-q2)*(1.0-2.0*q3)*(1.0-q3)+...               4.0*q1*(1.0-q1)*(1.0-2.0*q2)*(-1.0)*(1.0-2.0*q3)*(1.0-q3);        case 10            ft = -4.0*(1.0-2.0*q1)*q1*(1.0)*(1.0-q2)*(1.0-2.0*q3)*(1.0-q3)+...                -4.0*(1.0-2.0*q1)*q1*q2*(-1.0)*(1.0-2.0*q3)*(1.0-q3);        case 11            ft = -4.0*q1*(1.0-q1)*(-2.0)*q2*(1.0-2.0*q3)*(1.0-q3)+...                -4.0*q1*(1.0-q1)*(1.0-2.0*q2)*(1.0)*(1.0-2.0*q3)*(1.0-q3);        case 12            ft = 4.0*(1.0-2.0*q1)*(1.0-q1)*(1.0)*(1.0-q2)*(1.0-2.0*q3)*(1.0-q3)+...                4.0*(1.0-2.0*q1)*(1.0-q1)*q2*(-1.0)*(1.0-2.0*q3)*(1.0-q3);        case 13            ft = -4.0*q1*(1.0-q1)*(-2.0)*(1.0-q2)*(1.0-2.0*q3)*q3+...                -4.0*q1*(1.0-q1)*(1.0-2.0*q2)*(-1.0)*(1.0-2.0*q3)*q3;        case 14            ft = 4.0*(1.0-2.0*q1)*q1*(1.0)*(1.0-q2)*(1.0-2.0*q3)*q3+...                4.0*(1.0-2.0*q1)*q1*q2*(-1.0)*(1.0-2.0*q3)*q3;        case 15            ft = 4.0*q1*(1.0-q1)*(-2.0)*q2*(1.0-2.0*q3)*q3+...                4.0*q1*(1.0-q1)*(1.0-2.0*q2)*(1.0)*(1.0-2.0*q3)*q3;        case 16            ft = -4.0*(1.0-2.0*q1)*(1.0-q1)*(1.0)*(1.0-q2)*(1.0-2.0*q3)*q3+...                -4.0*(1.0-2.0*q1)*(1.0-q1)*q2*(-1.0)*(1.0-2.0*q3)*q3;        case 17            ft = 4.0*(1.0-2.0*q1)*(1.0-q1)*(-2.0)*(1.0-q2)*q3*(1.0-q3)+...                4.0*(1.0-2.0*q1)*(1.0-q1)*(1.0-2.0*q2)*(-1.0)*q3*(1.0-q3);        case 18            ft = -4.0*(1.0-2.0*q1)*q1*(-2.0)*(1.0-q2)*q3*(1.0-q3)+...                -4.0*(1.0-2.0*q1)*q1*(1.0-2.0*q2)*(-1.0)*q3*(1.0-q3);        case 19            ft = 4.0*(1.0-2.0*q1)*q1*(-2.0)*q2*q3*(1.0-q3)+...                4.0*(1.0-2.0*q1)*q1*(1.0-2.0*q2)*(1.0)*q3*(1.0-q3);        case 20            ft = -4.0*(1.0-2.0*q1)*(1.0-q1)*(-2.0)*q2*q3*(1.0-q3)+...                -4.0*(1.0-2.0*q1)*(1.0-q1)*(1.0-2.0*q2)*(1.0)*q3*(1.0-q3);        case 21            ft = 16.0*(1.0-2.0*q1)*(1.0-q1)*(1.0)*(1.0-q2)*q3*(1.0-q3)+...                16.0*(1.0-2.0*q1)*(1.0-q1)*q2*(-1.0)*q3*(1.0-q3);        case 22            ft = -16.0*(1.0-2.0*q1)*q1*(1.0)*(1.0-q2)*q3*(1.0-q3)+...                -16.0*(1.0-2.0*q1)*q1*q2*(-1.0)*q3*(1.0-q3);        case 23            ft = -16.0*q1*(1.0-q1)*(-2.0)*q2*q3*(1.0-q3)+...                -16.0*q1*(1.0-q1)*(1.0-2.0*q2)*(1.0)*q3*(1.0-q3);        case 24            ft = 16.0*q1*(1.0-q1)*(-2.0)*(1.0-q2)*q3*(1.0-q3)+...                16.0*q1*(1.0-q1)*(1.0-2.0*q2)*(-1.0)*q3*(1.0-q3);        case 25            ft = 16.0*q1*(1.0-q1)*(1.0)*(1.0-q2)*(1.0-2.0*q3)*(1.0-q3)+...                16.0*q1*(1.0-q1)*q2*(-1.0)*(1.0-2.0*q3)*(1.0-q3);        case 26            ft = -16.0*q1*(1.0-q1)*(1.0)*(1.0-q2)*(1.0-2.0*q3)*q3+...                -16.0*q1*(1.0-q1)*q2*(-1.0)*(1.0-2.0*q3)*q3;        case 27            ft = 64.0*q1*(1.0-q1)*(1.0)*(1.0-q2)*q3*(1.0-q3)+...                64.0*q1*(1.0-q1)*q2*(-1.0)*q3*(1.0-q3);    endendif(meltyp==20) 		  switch n    case 1      ft=(2.0*(1.0-q1)*(-1.0)*(1.0-q3)*(0.5-q1-q2-q3))+...          (2.0*(1.0-q1)*(1.0-q2)*(1.0-q3)*(-1.0));    case 2      ft=(-2.0*q1*(-1.0)*(1.0-q3)*(0.5-q1+q2+q3))+...          (-2.0*q1*(1.0-q2)*(1.0-q3)*(1.0));    case 3      ft=(2.0*q1*1.0*(1.0-q3)*(q1+q2-q3-1.5))+...          (2.0*q1*q2*(1.0-q3)*(1.0));    case 4      ft=(-2.0*(1.0-q1)*1.0*(1.0-q3)*(0.5+q1-q2+q3))+...          (-2.0*(1.0-q1)*q2*(1.0-q3)*(-1.0));    case 5      ft=(-2.0*(1.0-q1)*(-1.0)*q3*(0.5+q1+q2-q3))+...          (-2.0*(1.0-q1)*(1.0-q2)*q3*(1.0));    case 6      ft=(-2.0*q1*(-1.0)*q3*(1.5-q1+q2-q3))+...          (-2.0*q1*(1.0-q2)*q3*(1.0));      case 7      ft=(-2.0*q1*q3*(2.5-q1-q2-q3))+...          (-2.0*q1*q2*q3*(-1.0));      case 8      ft=(-2.0*(1.0-q1)*1.0*q3*(1.5+q1-q2-q3))+...          (-2.0*(1.0-q1)*q2*q3*(-1.0));    case 12      ft=(4.0*(1.0-q1)*1.0*(1.0-q2)*(1.0-q3))+...          4.0*(1.0-q1)*q2*(-1.0)*(1.0-q3);    case 11      ft=(4.0*q1*(1.0-q1)*1.0*(1.0-q3));    case 10      ft=(4.0*q1*1.0*(1.0-q2)*(1.0-q3))+...          (4.0*q1*q2*(-1.0)*(1.0-q3));    case 9      ft=4.0*q1*(1.0-q1)*(-1.0)*(1.0-q3);    case 16      ft=(4.0*(1.0-q1)*1.0*(1.0-q2)*q3)+...          (4.0*(1.0-q1)*q2*(-1.0)*q3);    case 15      ft=4.0*q1*(1.0-q1)*1.0*q3;    case 14      ft=(4.0*q1*1.0*(1.0-q2)*q3)+...          (4.0*q1*q2*(-1.0)*q3);    case 13      ft=4.0*q1*(1.0-q1)*(-1.0)*q3;    case 17      ft=4.0*(1.0-q1)*(-1.0)*q3*(1.0-q3);    case 20      ft=4.0*(1.0-q1)*1.0*q3*(1.0-q3);    case 19      ft=4.0*q1*1.0*q3*(1.0-q3);    case 18      ft=4.0*q1*(-1.0)*q3*(1.0-q3);      endendif(meltyp==8)		    switch n    case 1     ft=(1.0-q1)*(-1.0)*(1.0-q3);	    case 2     ft=      q1*(-1.0)*(1.0-q3);	    case 4     ft=(1.0-q1)* (1.0)*(1.0-q3);	    case 3     ft=      q1* (1.0)*(1.0-q3);	    case 5     ft=(1.0-q1)*(-1.0)   *q3;	    case 6     ft=      q1*(-1.0)   *q3;	    case 8     ft=(1.0-q1)*  (1.0)  *q3;	    case 7     ft=      q1*  (1.0)  *q3;	    end      end                                                                      