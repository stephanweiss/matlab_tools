function fz=fze3d(q1,q2,q3,n,meltyp) % shape function derivative wrt xiif(meltyp==10) 		  switch n    case 1      fz=((-2.0)*(1.0-q1-q2-q3))+...          ((1.0-2.0*q1-2.0*q2-2.0*q3)*(-1.0));	    case 2      fz=0.0;    case 3      fz=0.0;    case 4      fz=((2.0)*q3)+((2.0*q3-1.0)*1.0);    case 5       fz=4.0*q1*(-1.0);		    case 6       fz=4.0*q2*(-1.0);	    case 7       fz=(4.0*q3*(-1.0))+(4.0*(1.0-q1-q2-q3));    case 8       fz=0.0;    case 9       fz=4.0*q2;    case 10       fz=4.0*q1;           endendif(meltyp==27) 		  	switch n        case 1           fz = (1.0-2.0*q1)*(1.0-q1)*(1.0-2.0*q2)*(1.0-q2)*(-2.0)*(1.0-q3)+...               (1.0-2.0*q1)*(1.0-q1)*(1.0-2.0*q2)*(1.0-q2)*(1.0-2.0*q3)*(-1.0);        case 2           fz = -(1.0-2.0*q1)*q1*(1.0-2.0*q2)*(1.0-q2)*(-2.0)*(1.0-q3)+...               -(1.0-2.0*q1)*q1*(1.0-2.0*q2)*(1.0-q2)*(1.0-2.0*q3)*(-1.0);        case 3           fz = (1.0-2.0*q1)*q1*(1.0-2.0*q2)*q2*(-2.0)*(1.0-q3)+...               (1.0-2.0*q1)*q1*(1.0-2.0*q2)*q2*(1.0-2.0*q3)*(-1.0);        case 4           fz = -(1.0-2.0*q1)*(1.0-q1)*(1.0-2.0*q2)*q2*(-2.0)*(1.0-q3)+...               -(1.0-2.0*q1)*(1.0-q1)*(1.0-2.0*q2)*q2*(1.0-2.0*q3)*(-1.0);        case 5           fz = -(1.0-2.0*q1)*(1.0-q1)*(1.0-2.0*q2)*(1.0-q2)*(-2.0)*q3+...               -(1.0-2.0*q1)*(1.0-q1)*(1.0-2.0*q2)*(1.0-q2)*(1.0-2.0*q3)*(1.0);        case 6           fz = (1.0-2.0*q1)*q1*(1.0-2.0*q2)*(1.0-q2)*(-2.0)*q3+...               (1.0-2.0*q1)*q1*(1.0-2.0*q2)*(1.0-q2)*(1.0-2.0*q3)*(1.0);        case 7           fz = -(1.0-2.0*q1)*q1*(1.0-2.0*q2)*q2*(-2.0)*q3+...               -(1.0-2.0*q1)*q1*(1.0-2.0*q2)*q2*(1.0-2.0*q3)*(1.0);        case 8           fz = (1.0-2.0*q1)*(1.0-q1)*(1.0-2.0*q2)*q2*(-2.0)*q3+...               (1.0-2.0*q1)*(1.0-q1)*(1.0-2.0*q2)*q2*(1.0-2.0*q3)*(1.0);        case 9           fz = 4.0*q1*(1.0-q1)*(1.0-2.0*q2)*(1.0-q2)*(-2.0)*(1.0-q3)+...               4.0*q1*(1.0-q1)*(1.0-2.0*q2)*(1.0-q2)*(1.0-2.0*q3)*(-1.0);        case 10            fz = -4.0*(1.0-2.0*q1)*q1*q2*(1.0-q2)*(-2.0)*(1.0-q3)+...                -4.0*(1.0-2.0*q1)*q1*q2*(1.0-q2)*(1.0-2.0*q3)*(-1.0);        case 11            fz = -4.0*q1*(1.0-q1)*(1.0-2.0*q2)*q2*(-2.0)*(1.0-q3)+...                -4.0*q1*(1.0-q1)*(1.0-2.0*q2)*q2*(1.0-2.0*q3)*(-1.0);        case 12            fz = 4.0*(1.0-2.0*q1)*(1.0-q1)*q2*(1.0-q2)*(-2.0)*(1.0-q3)+...                4.0*(1.0-2.0*q1)*(1.0-q1)*q2*(1.0-q2)*(1.0-2.0*q3)*(-1.0);        case 13            fz = -4.0*q1*(1.0-q1)*(1.0-2.0*q2)*(1.0-q2)*(-2.0)*q3+...                -4.0*q1*(1.0-q1)*(1.0-2.0*q2)*(1.0-q2)*(1.0-2.0*q3)*(1.0);        case 14            fz = 4.0*(1.0-2.0*q1)*q1*q2*(1.0-q2)*(-2.0)*q3+...                4.0*(1.0-2.0*q1)*q1*q2*(1.0-q2)*(1.0-2.0*q3)*(1.0);        case 15            fz = 4.0*q1*(1.0-q1)*(1.0-2.0*q2)*q2*(-2.0)*q3+...                4.0*q1*(1.0-q1)*(1.0-2.0*q2)*q2*(1.0-2.0*q3)*(1.0);        case 16            fz = -4.0*(1.0-2.0*q1)*(1.0-q1)*q2*(1.0-q2)*(-2.0)*q3+...                -4.0*(1.0-2.0*q1)*(1.0-q1)*q2*(1.0-q2)*(1.0-2.0*q3)*(1.0);        case 17            fz = 4.0*(1.0-2.0*q1)*(1.0-q1)*(1.0-2.0*q2)*(1.0-q2)*(1.0)*(1.0-q3)+...                4.0*(1.0-2.0*q1)*(1.0-q1)*(1.0-2.0*q2)*(1.0-q2)*q3*(-1.0);        case 18            fz = -4.0*(1.0-2.0*q1)*q1*(1.0-2.0*q2)*(1.0-q2)*(1.0)*(1.0-q3)+...                -4.0*(1.0-2.0*q1)*q1*(1.0-2.0*q2)*(1.0-q2)*q3*(-1.0);        case 19            fz = 4.0*(1.0-2.0*q1)*q1*(1.0-2.0*q2)*q2*(1.0)*(1.0-q3)+...                4.0*(1.0-2.0*q1)*q1*(1.0-2.0*q2)*q2*q3*(-1.0);        case 20            fz = -4.0*(1.0-2.0*q1)*(1.0-q1)*(1.0-2.0*q2)*q2*(1.0)*(1.0-q3)+...                -4.0*(1.0-2.0*q1)*(1.0-q1)*(1.0-2.0*q2)*q2*q3*(-1.0);        case 21            fz = 16.0*(1.0-2.0*q1)*(1.0-q1)*q2*(1.0-q2)*(1.0)*(1.0-q3)+...                16.0*(1.0-2.0*q1)*(1.0-q1)*q2*(1.0-q2)*q3*(-1.0);        case 22            fz = -16.0*(1.0-2.0*q1)*q1*q2*(1.0-q2)*(1.0)*(1.0-q3)+...                -16.0*(1.0-2.0*q1)*q1*q2*(1.0-q2)*q3*(-1.0);        case 23            fz = -16.0*q1*(1.0-q1)*(1.0-2.0*q2)*q2*(1.0)*(1.0-q3)+...                -16.0*q1*(1.0-q1)*(1.0-2.0*q2)*q2*q3*(-1.0);        case 24            fz = 16.0*q1*(1.0-q1)*(1.0-2.0*q2)*(1.0-q2)*(1.0)*(1.0-q3)+...                16.0*q1*(1.0-q1)*(1.0-2.0*q2)*(1.0-q2)*q3*(-1.0);        case 25            fz = 16.0*q1*(1.0-q1)*q2*(1.0-q2)*(-2.0)*(1.0-q3)+...                16.0*q1*(1.0-q1)*q2*(1.0-q2)*(1.0-2.0*q3)*(-1.0);        case 26            fz = -16.0*q1*(1.0-q1)*q2*(1.0-q2)*(-2.0)*q3+...                -16.0*q1*(1.0-q1)*q2*(1.0-q2)*(1.0-2.0*q3)*(1.0);        case 27            fz = 64.0*q1*(1.0-q1)*q2*(1.0-q2)*(1.0)*(1.0-q3)+...                64.0*q1*(1.0-q1)*q2*(1.0-q2)*q3*(-1.0);    endendif(meltyp==20) 		  switch n    case 1      fz=(2.0*(1.0-q1)*(1.0-q2)*(-1.0)*(0.5-q1-q2-q3))+...          (2.0*(1.0-q1)*(1.0-q2)*(1.0-q3)*(-1.0));    case 2      fz=(-2.0*q1*(1.0-q2)*(-1.0)*(0.5-q1+q2+q3))+...          (-2.0*q1*(1.0-q2)*(1.0-q3)*(1.0));    case 3      fz=(2.0*q1*q2*(-1.0)*(q1+q2-q3-1.5))+...          (2.0*q1*q2*(1.0-q3)*(-1.0));    case 4      fz=(-2.0*(1.0-q1)*q2*(-1.0)*(0.5+q1-q2+q3))+...          (-2.0*(1.0-q1)*q2*(1.0-q3)*(1.0));    case 5      fz=(-2.0*(1.0-q1)*(1.0-q2)*1.0*(0.5+q1+q2-q3))+...          (-2.0*(1.0-q1)*(1.0-q2)*q3*(-1.0));    case 6      fz=(-2.0*q1*(1.0-q2)*1.0*(1.5-q1+q2-q3))+...          (-2.0*q1*(1.0-q2)*q3*(-1.0));      case 7      fz=(-2.0*q1*q2*1.0*(2.5-q1-q2-q3))+...          (-2.0*q1*q2*q3*(-1.0));      case 8      fz=(-2.0*(1.0-q1)*q2*1.0*(1.5+q1-q2-q3))+...          (-2.0*(1.0-q1)*q2*q3*(-1.0));    case 12      fz=4.0*(1.0-q1)*q2*(1.0-q2)*(-1.0);    case 11      fz=4.0*q1*(1.0-q1)*q2*(-1.0);    case 10      fz=4.0*q1*q2*(1.0-q2)*(-1.0);    case 9      fz=4.0*q1*(1.0-q1)*(1.0-q2)*(-1.0);    case 16      fz=4.0*(1.0-q1)*q2*(1.0-q2)*1.0;    case 15      fz=4.0*q1*(1.0-q1)*q2*1.0;    case 14      fz=4.0*q1*q2*(1.0-q2)*1.0;    case 13      fz=4.0*q1*(1.0-q1)*(1.0-q2)*1.0;    case 17      fz=(4.0*(1.0-q1)*(1.0-q2)*1.0*(1.0-q3))+...          (4.0*(1.0-q1)*(1.0-q2)*q3*(-1.0));    case 20      fz=(4.0*(1.0-q1)*q2*1.0*(1.0-q3))+...          (4.0*(1.0-q1)*q2*q3*(-1.0));    case 19      fz=(4.0*q1*q2*1.0*(1.0-q3))+...          (4.0*q1*q2*q3*(-1.0));    case 18      fz=(4.0*q1*(1.0-q2)*1.0*(1.0-q3))+...          (4.0*q1*(1.0-q2)*q3*(-1.0));      endendif(meltyp==8)		    switch n    case 1     fz=(1.0-q1)*(1.0-q2)*(-1.0);	    case 2     fz=      q1*(1.0-q2)*(-1.0);	    case 4     fz=(1.0-q1)*    q2  *(-1.0);	    case 3     fz=      q1*    q2  *(-1.0);	    case 5     fz=(1.0-q1)*(1.0-q2)*(1.0);	    case 6     fz=      q1*(1.0-q2)*(1.0);	    case 8     fz=(1.0-q1)*    q2  *(1.0);	    case 7     fz=      q1*    q2  *(1.0);	    end      end                                                                         