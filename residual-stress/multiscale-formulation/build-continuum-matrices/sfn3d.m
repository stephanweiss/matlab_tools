function sf=sfn3d(q1,q2,q3,n,meltyp)% shape functions% Added by eralp, checked-corrected! if(meltyp == 27)    	switch n        case 1           sf = (1.0-2.0*q1)*(1.0-q1)*(1.0-2.0*q2)*(1.0-q2)*(1.0-2.0*q3)*(1.0-q3);        case 2           sf = -(1.0-2.0*q1)*q1*(1.0-2.0*q2)*(1.0-q2)*(1.0-2.0*q3)*(1.0-q3);        case 3           sf = (1.0-2.0*q1)*q1*(1.0-2.0*q2)*q2*(1.0-2.0*q3)*(1.0-q3);        case 4           sf = -(1.0-2.0*q1)*(1.0-q1)*(1.0-2.0*q2)*q2*(1.0-2.0*q3)*(1.0-q3);        case 5           sf = -(1.0-2.0*q1)*(1.0-q1)*(1.0-2.0*q2)*(1.0-q2)*(1.0-2.0*q3)*q3;        case 6           sf = (1.0-2.0*q1)*q1*(1.0-2.0*q2)*(1.0-q2)*(1.0-2.0*q3)*q3;        case 7           sf = -(1.0-2.0*q1)*q1*(1.0-2.0*q2)*q2*(1.0-2.0*q3)*q3;        case 8           sf = (1.0-2.0*q1)*(1.0-q1)*(1.0-2.0*q2)*q2*(1.0-2.0*q3)*q3;        case 9           sf = 4.0*q1*(1.0-q1)*(1.0-2.0*q2)*(1.0-q2)*(1.0-2.0*q3)*(1.0-q3);        case 10            sf = -4.0*(1.0-2.0*q1)*q1*q2*(1.0-q2)*(1.0-2.0*q3)*(1.0-q3);        case 11            sf = -4.0*q1*(1.0-q1)*(1.0-2.0*q2)*q2*(1.0-2.0*q3)*(1.0-q3);        case 12            sf = 4.0*(1.0-2.0*q1)*(1.0-q1)*q2*(1.0-q2)*(1.0-2.0*q3)*(1.0-q3);        case 13            sf = -4.0*q1*(1.0-q1)*(1.0-2.0*q2)*(1.0-q2)*(1.0-2.0*q3)*q3;        case 14            sf = 4.0*(1.0-2.0*q1)*q1*q2*(1.0-q2)*(1.0-2.0*q3)*q3;        case 15            sf = 4.0*q1*(1.0-q1)*(1.0-2.0*q2)*q2*(1.0-2.0*q3)*q3;        case 16            sf = -4.0*(1.0-2.0*q1)*(1.0-q1)*q2*(1.0-q2)*(1.0-2.0*q3)*q3;        case 17            sf = 4.0*(1.0-2.0*q1)*(1.0-q1)*(1.0-2.0*q2)*(1.0-q2)*q3*(1.0-q3);        case 18            sf = -4.0*(1.0-2.0*q1)*q1*(1.0-2.0*q2)*(1.0-q2)*q3*(1.0-q3);        case 19            sf = 4.0*(1.0-2.0*q1)*q1*(1.0-2.0*q2)*q2*q3*(1.0-q3);        case 20            sf = -4.0*(1.0-2.0*q1)*(1.0-q1)*(1.0-2.0*q2)*q2*q3*(1.0-q3);        case 21            sf = 16.0*(1.0-2.0*q1)*(1.0-q1)*q2*(1.0-q2)*q3*(1.0-q3);        case 22            sf = -16.0*(1.0-2.0*q1)*q1*q2*(1.0-q2)*q3*(1.0-q3);        case 23            sf = -16.0*q1*(1.0-q1)*(1.0-2.0*q2)*q2*q3*(1.0-q3);        case 24            sf = 16.0*q1*(1.0-q1)*(1.0-2.0*q2)*(1.0-q2)*q3*(1.0-q3);        case 25            sf = 16.0*q1*(1.0-q1)*q2*(1.0-q2)*(1.0-2.0*q3)*(1.0-q3);        case 26            sf = -16.0*q1*(1.0-q1)*q2*(1.0-q2)*(1.0-2.0*q3)*q3;        case 27            sf = 64.0*q1*(1.0-q1)*q2*(1.0-q2)*q3*(1.0-q3);    endend% Added by eralp, checked-corrected! if( meltyp == 20)	switch n    case 1      sf=2.0*(1.0-q1)*(1.0-q2)*(1.0-q3)*(0.5-q1-q2-q3);    case 2      sf=-2.0*q1*(1.0-q2)*(1.0-q3)*(0.5-q1+q2+q3);    case 3      sf=2.0*q1*q2*(1.0-q3)*(q1+q2-q3-1.5);    case 4      sf=-2.0*(1.0-q1)*q2*(1.0-q3)*(0.5+q1-q2+q3);    case 5      sf=-2.0*(1.0-q1)*(1.0-q2)*q3*(0.5+q1+q2-q3);    case 6      sf=-2.0*q1*(1.0-q2)*q3*(1.5-q1+q2-q3);      case 7      sf=-2.0*q1*q2*q3*(2.5-q1-q2-q3);      case 8      sf=-2.0*(1.0-q1)*q2*q3*(1.5+q1-q2-q3);    case 12      sf=4.0*(1.0-q1)*q2*(1.0-q2)*(1.0-q3);    case 11      sf=4.0*q1*(1.0-q1)*q2*(1.0-q3);    case 10      sf=4.0*q1*q2*(1.0-q2)*(1.0-q3);    case 9      sf=4.0*q1*(1.0-q1)*(1.0-q2)*(1.0-q3);    case 16      sf=4.0*(1.0-q1)*q2*(1.0-q2)*q3;    case 15      sf=4.0*q1*(1.0-q1)*q2*q3;    case 14      sf=4.0*q1*q2*(1.0-q2)*q3;    case 13      sf=4.0*q1*(1.0-q1)*(1.0-q2)*q3;    case 17      sf=4.0*(1.0-q1)*(1.0-q2)*q3*(1.0-q3);    case 20      sf=4.0*(1.0-q1)*q2*q3*(1.0-q3);    case 19      sf=4.0*q1*q2*q3*(1.0-q3);    case 18      sf=4.0*q1*(1.0-q2)*q3*(1.0-q3);      endend% Added by eralp, NOT checked! if( meltyp == 10)	switch n    case 1      sf=(1.0-2.0*q1-2.0*q2-2.0*q3)*(1.0-q1-q2-q3);	    case 2      sf=(2.0*q1-1.0)*q1;    case 3      sf=(2.0*q2-1.0)*q2;    case 4      sf=(2.0*q3-1.0)*q3;    case 5       sf=4.0*q1*(1.0-q1-q2-q3);		    case 6       sf=4.0*q2*(1.0-q1-q2-q3);	    case 7       sf=4.0*q3*(1.0-q1-q2-q3);    case 8       sf=4.0*q1*q2;    case 9       sf=4.0*q2*q3;    case 10       sf=4.0*q1*q3;           endendif( meltyp == 8)	  switch n    case 1     sf=(1.0-q1)*(1.0-q2)*(1.0-q3);	    case 2     sf=      q1*(1.0-q2)*(1.0-q3);	    case 4     sf=(1.0-q1)*    q2  *(1.0-q3);	    case 3     sf=      q1*    q2  *(1.0-q3);	    case 5     sf=(1.0-q1)*(1.0-q2)*q3;	    case 6     sf=      q1*(1.0-q2)*q3;	    case 8     sf=(1.0-q1)*    q2  *q3;	    case 7     sf=      q1*    q2  *q3;	    endend                                                                                                                             