function fi=fxi3d(q1,q2,q3,n,meltyp) % shape function derivatives with respect to xi if(meltyp==10)    switch n    case 1      fi=((-2.0)*(1.0-q1-q2-q3))+((1.0-2.0*q1-2.0*q2-2.0*q3)*(-1.0));	    case 2      fi=((2.0)*q1)+((2.0*q1-1.0)*1.0);    case 3      fi=0.0;    case 4      fi=0.0;    case 5       fi=(4.0*1.0*(1.0-q1-q2-q3))+(4.0*q1*(-1.0));		    case 6       fi=4.0*q2*(-1.0);	    case 7       fi=4.0*q3*(-1.0);    case 8       fi=4.0*(1.0)*q2;    case 9       fi=0.0;    case 10       fi=4.0*(1.0)*q3;      end	  end                                                               if(meltyp==27)		switch n        case 1           fi = (-2.0)*(1.0-q1)*(1.0-2.0*q2)*(1.0-q2)*(1.0-2.0*q3)*(1.0-q3)+...               (1.0-2.0*q1)*(-1.0)*(1.0-2.0*q2)*(1.0-q2)*(1.0-2.0*q3)*(1.0-q3);        case 2           fi = (2.0)*q1*(1.0-2.0*q2)*(1.0-q2)*(1.0-2.0*q3)*(1.0-q3)+...               -(1.0-2.0*q1)*(1.0)*(1.0-2.0*q2)*(1.0-q2)*(1.0-2.0*q3)*(1.0-q3);        case 3           fi = (-2.0)*q1*(1.0-2.0*q2)*q2*(1.0-2.0*q3)*(1.0-q3)+...               (1.0-2.0*q1)*(1.0)*(1.0-2.0*q2)*q2*(1.0-2.0*q3)*(1.0-q3);        case 4           fi = (2.0)*(1.0-q1)*(1.0-2.0*q2)*q2*(1.0-2.0*q3)*(1.0-q3)+...               (1.0-2.0*q1)*(1.0)*(1.0-2.0*q2)*q2*(1.0-2.0*q3)*(1.0-q3);        case 5           fi = (2.0)*(1.0-q1)*(1.0-2.0*q2)*(1.0-q2)*(1.0-2.0*q3)*q3+...               (1.0-2.0*q1)*(1.0)*(1.0-2.0*q2)*(1.0-q2)*(1.0-2.0*q3)*q3;        case 6           fi = (-2.0)*q1*(1.0-2.0*q2)*(1.0-q2)*(1.0-2.0*q3)*q3+...               (1.0-2.0*q1)*(1.0)*(1.0-2.0*q2)*(1.0-q2)*(1.0-2.0*q3)*q3;        case 7           fi = (2.0)*q1*(1.0-2.0*q2)*q2*(1.0-2.0*q3)*q3+...               (1.0-2.0*q1)*(-1.0)*(1.0-2.0*q2)*q2*(1.0-2.0*q3)*q3;        case 8           fi = (-2.0)*(1.0-q1)*(1.0-2.0*q2)*q2*(1.0-2.0*q3)*q3+...               (1.0-2.0*q1)*(-1.0)*(1.0-2.0*q2)*q2*(1.0-2.0*q3)*q3;        case 9           fi = 4.0*(1.0)*(1.0-q1)*(1.0-2.0*q2)*(1.0-q2)*(1.0-2.0*q3)*(1.0-q3)+...               4.0*q1*(-1.0)*(1.0-2.0*q2)*(1.0-q2)*(1.0-2.0*q3)*(1.0-q3);        case 10            fi = 4.0*(2.0)*q1*q2*(1.0-q2)*(1.0-2.0*q3)*(1.0-q3)+...                4.0*(1.0-2.0*q1)*(-1.0)*q2*(1.0-q2)*(1.0-2.0*q3)*(1.0-q3);        case 11            fi = -4.0*(1.0)*(1.0-q1)*(1.0-2.0*q2)*q2*(1.0-2.0*q3)*(1.0-q3)+...                4.0*q1*(1.0)*(1.0-2.0*q2)*q2*(1.0-2.0*q3)*(1.0-q3);        case 12            fi = 4.0*(-2.0)*(1.0-q1)*q2*(1.0-q2)*(1.0-2.0*q3)*(1.0-q3)+...                4.0*(1.0-2.0*q1)*(-1.0)*q2*(1.0-q2)*(1.0-2.0*q3)*(1.0-q3);        case 13            fi = -4.0*(1.0)*(1.0-q1)*(1.0-2.0*q2)*(1.0-q2)*(1.0-2.0*q3)*q3+...                4.0*q1*(1.0)*(1.0-2.0*q2)*(1.0-q2)*(1.0-2.0*q3)*q3;        case 14            fi = 4.0*(-2.0)*q1*q2*(1.0-q2)*(1.0-2.0*q3)*q3+...                4.0*(1.0-2.0*q1)*(1.0)*q2*(1.0-q2)*(1.0-2.0*q3)*q3;        case 15            fi = 4.0*(1.0)*(1.0-q1)*(1.0-2.0*q2)*q2*(1.0-2.0*q3)*q3+...                4.0*q1*(-1.0)*(1.0-2.0*q2)*q2*(1.0-2.0*q3)*q3;        case 16            fi = 4.0*(2.0)*(1.0-q1)*q2*(1.0-q2)*(1.0-2.0*q3)*q3+...                4.0*(1.0-2.0*q1)*(1.0)*q2*(1.0-q2)*(1.0-2.0*q3)*q3;        case 17            fi = 4.0*(-2.0)*(1.0-q1)*(1.0-2.0*q2)*(1.0-q2)*q3*(1.0-q3)+...                4.0*(1.0-2.0*q1)*(-1.0)*(1.0-2.0*q2)*(1.0-q2)*q3*(1.0-q3);        case 18            fi = 4.0*(2.0)*q1*(1.0-2.0*q2)*(1.0-q2)*q3*(1.0-q3)+...                -4.0*(1.0-2.0*q1)*(1.0)*(1.0-2.0*q2)*(1.0-q2)*q3*(1.0-q3);        case 19            fi = 4.0*(-2.0)*q1*(1.0-2.0*q2)*q2*q3*(1.0-q3)+...                4.0*(1.0-2.0*q1)*(1.0)*(1.0-2.0*q2)*q2*q3*(1.0-q3);        case 20            fi = 4.0*(2.0)*(1.0-q1)*(1.0-2.0*q2)*q2*q3*(1.0-q3)+...                4.0*(1.0-2.0*q1)*(1.0)*(1.0-2.0*q2)*q2*q3*(1.0-q3);        case 21            fi = 16.0*(-2.0)*(1.0-q1)*q2*(1.0-q2)*q3*(1.0-q3)+...                16.0*(1.0-2.0*q1)*(-1.0)*q2*(1.0-q2)*q3*(1.0-q3);        case 22            fi = 16.0*(2.0)*q1*q2*(1.0-q2)*q3*(1.0-q3)+...                -16.0*(1.0-2.0*q1)*(1.0)*q2*(1.0-q2)*q3*(1.0-q3);        case 23            fi = -16.0*(1.0)*(1.0-q1)*(1.0-2.0*q2)*q2*q3*(1.0-q3)+...                16.0*q1*(1.0)*(1.0-2.0*q2)*q2*q3*(1.0-q3);        case 24            fi = 16.0*(1.0)*(1.0-q1)*(1.0-2.0*q2)*(1.0-q2)*q3*(1.0-q3)+...                16.0*q1*(-1.0)*(1.0-2.0*q2)*(1.0-q2)*q3*(1.0-q3);        case 25            fi = 16.0*(1.0)*(1.0-q1)*q2*(1.0-q2)*(1.0-2.0*q3)*(1.0-q3)+...                16.0*q1*(-1.0)*q2*(1.0-q2)*(1.0-2.0*q3)*(1.0-q3);        case 26            fi = -16.0*(1.0)*(1.0-q1)*q2*(1.0-q2)*(1.0-2.0*q3)*q3+...                16.0*q1*(1.0)*q2*(1.0-q2)*(1.0-2.0*q3)*q3;        case 27            fi = 64.0*(1.0)*(1.0-q1)*q2*(1.0-q2)*q3*(1.0-q3)+...                64.0*q1*(-1.0)*q2*(1.0-q2)*q3*(1.0-q3);    end	  end                                                               if(meltyp==20)       switch n    case 1      fi=(2.0*(-1.0)*(1.0-q2)*(1.0-q3)*(0.5-q1-q2-q3))+...          (2.0*(1.0-q1)*(1.0-q2)*(1.0-q3)*(-1.0));    case 2      fi=(-2.0*1.0*(1.0-q2)*(1.0-q3)*(0.5-q1+q2+q3))+...          (-2.0*q1*(1.0-q2)*(1.0-q3)*(-1.0));    case 3      fi=(2.0*1.0*q2*(1.0-q3)*(q1+q2-q3-1.5))+...          (2.0*q1*q2*(1.0-q3)*(1.0));    case 4      fi=(-2.0*(-1.0)*q2*(1.0-q3)*(0.5+q1-q2+q3))+...          (-2.0*(1.0-q1)*q2*(1.0-q3)*(1.0));    case 5      fi=(-2.0*(-1.0)*(1.0-q2)*q3*(0.5+q1+q2-q3))+...          (-2.0*(1.0-q1)*(1.0-q2)*q3*(1.0));    case 6      fi=(-2.0*1.0*(1.0-q2)*q3*(1.5-q1+q2-q3))+...          (-2.0*q1*(1.0-q2)*q3*(-1.0));      case 7      fi=(-2.0*1.0*q2*q3*(2.5-q1-q2-q3))+...          (-2.0*q1*q2*q3*(-1.0));      case 8      fi=(-2.0*(-1.0)*q2*q3*(1.5+q1-q2-q3))+...          (-2.0*(1.0-q1)*q2*q3*(1.0));    case 12      fi=(4.0*(-1.0)*q2*(1.0-q2)*(1.0-q3));    case 11      fi=(4.0*1.0*(1.0-q1)*q2*(1-q3))+...          (4.0*q1*(-1.0)*q2*(1-q3));    case 10      fi=4.0*1.0*q2*(1.0-q2)*(1-q3);    case 9      fi=(4.0*1.0*(1.0-q1)*(1.0-q2)*(1-q3))+...          (4.0*q1*(-1.0)*(1.0-q2)*(1-q3));    case 16      fi=4.0*(-1.0)*q2*(1.0-q2)*q3;    case 15      fi=(4.0*1.0*(1.0-q1)*q2*q3)+...          (4.0*q1*(-1.0)*q2*q3);    case 14      fi=4.0*1.0*q2*(1.0-q2)*q3;    case 13      fi=(4.0*1.0*(1.0-q1)*(1.0-q2)*q3)+...          (4.0*q1*(-1.0)*(1.0-q2)*q3);    case 17      fi=4.0*(-1.0)*(1.0-q2)*q3*(1-q3);    case 20      fi=4.0*(-1.0)*q2*q3*(1-q3);    case 19      fi=4.0*1.0*q2*q3*(1-q3);    case 18      fi=4.0*1.0*(1.0-q2)*q3*(1-q3);      end   endif(meltyp==8)		switch n      case 1     fi=-1.0*(1.0-q2)*(1.0-q3);	    case 2     fi= 1.0*(1.0-q2)*(1.0-q3);	    case 4     fi=-1.0*    q2  *(1.0-q3);	    case 3     fi= 1.0*    q2  *(1.0-q3);	    case 5     fi=-1.0*(1.0-q2)*q3;	    case 6     fi= 1.0*(1.0-q2)*q3;	    case 8     fi=-1.0*    q2  *q3;	    case 7     fi= 1.0*    q2  *q3;	    endend                                                                                                                                  