function [nqptv,wtq,sfac,dndxi,dndet,dndze,nqpts,swt,ssfac,dnda,dndb] = shafac(meltyp,nnpe,nnps)% initialize the shape function arrays% NOTES:% Volume integration of 10 node tetragonal is missing% Check the weights and the assignments for the variable "wts" % For 8-node brick element volume integrationif(meltyp==8)          nqptv=8;            dndxi = zeros(nnpe,nqptv);      dndet = zeros(nnpe,nqptv);      dndze = zeros(nnpe,nqptv);      sfac  = zeros(nnpe,nqptv);      wtq = zeros(nqptv,1);      qploc=1.0/sqrt(3.0);      qpt(1)=(1.0-qploc)/2.0;                                                 qpt(2)=(1.0+qploc)/2.0;      wts(1)=0.5;                                               wts(2)=0.5;                j1v = zeros(nqptv);      j2v = zeros(nqptv);      j3v = zeros(nqptv);      ic = 0;      for i=1:2          for j=1:2              for k = 1:2                  ic = ic+1;                  j1v(ic) = i;                  j2v(ic) = j;                  j3v(ic) = k;              end          end      end   for i=1:1:nnpe                                                        for  j=1:1:nqptv                            j1 = j1v(j);         j2 = j2v(j);         j3 = j3v(j);                                                       q1=qpt(j1);                                                             q2=qpt(j2);                                                              q3=qpt(j3);                                                            sfac(i,j) =sfn3d(q1,q2,q3,i,meltyp);                                                  dndxi(i,j)=fxi3d(q1,q2,q3,i,meltyp);                                                 dndet(i,j)=fet3d(q1,q2,q3,i,meltyp);                                                 dndze(i,j)=fze3d(q1,q2,q3,i,meltyp);                                                 wtq(j)=wts(j1)*wts(j2)*wts(j3);      end   end  end  % For 8-node brick element surface integrationif(meltyp==8)      nqpts=4;      qploc=1.0/sqrt(3.0);      qpts(1)=(1.0-qploc)/2.0;                                                 qpts(2)=(1.0+qploc)/2.0;      swts(1)=0.5;                                               swts(2)=0.5;                ssfac  = zeros(nnps,nqpts);        dnda   = zeros(nnps,nqpts);        dndb   = zeros(nnps,nqpts);      swt = zeros(nqpts,1);      ic = 0;      for i=1:2          for j=1:2              ic = ic+1;              j1s(ic) = i;              j2s(ic) = j;                             end      end                            for i=1:1:nnps                   for  j=1:1:nqpts                                                 j1 = j1s(j);         j2 = j2s(j);                   q1=qpts(j1);                                                             q2=qpts(j2);                                                             ssfac(i,j)=sfn(q1,q2,i,meltyp);                                                  dnda(i,j)=fxi(q1,q2,i,meltyp);                                                 dndb(i,j)=fet(q1,q2,i,meltyp);                                                 swt(j) = swts(j1)*swts(j2);            end   end  end   % For 10-node tetragonal element surface integrationif(meltyp==10)      nqpts=7;		  a1=.05971587178977;      b1=.47014206410512;      c1=.79742698535309;      d1=.10128650732346;      qpts(1,1)=0.33333333333333;      qpts(1,2)=0.33333333333333;      qpts(2,1)=a1;      qpts(2,2)=b1;      qpts(3,1)=b1;      qpts(3,2)=a1;      qpts(4,1)=b1;      qpts(4,2)=b1;      qpts(5,1)=c1;      qpts(5,2)=d1;      qpts(6,1)=d1;      qpts(6,2)=c1;      qpts(7,1)=d1;      qpts(7,2)=d1;      swts(1)=0.1125;      swts(2)=0.06619707639425;      swts(3)=swts(2);      swts(4)=swts(2);      swts(5)=0.06296959027241;      swts(6)=swts(5);      swts(7)=swts(5);	   for i=1:1:nnps                                                        for  j=1:1:nqpts                                                        q1=qpts(j,1);                                                             q2=qpts(j,2);                                                             ssfac(i,j)=sfn(q1,q2,i,meltyp);                                                  dnda(i,j)=fxi(q1,q2,i,meltyp);                                                 dndb(i,j)=fet(q1,q2,i,meltyp);                                                 swt(j)=swts(j);      end   end  end % For 20-node brick element surface integrationif(meltyp==20)      nqpts=9;      qpts(1)=0.1127016653793;                                                 qpts(2)=0.50;                                                            qpts(3)=1.0-qpts(1);                                                      swts(1)=0.5555555555556/2.;                                               swts(2)=0.8888888888889/2.;                                               swts(3)=swts(1);                  j1s = zeros(nqpts);      j2s = zeros(nqpts);      ic = 0;            for i=1:3          for j=1:3                ic = ic+1;                j1s(ic) = i;                j2s(ic) = j;                             end      end		     for  i=1:1:nnps                                                        for  j=1:1:nqpts		 	     j1 = j1s(j);         j2 = j2s(j);                                                        q1=qpts(j1);                                                              q2=qpts(j2);                                                              ssfac(i,j)=sfn(q1,q2,i,meltyp);                                                  dnda(i,j)=fxi(q1,q2,i,meltyp);                                                 dndb(i,j)=fet(q1,q2,i,meltyp);                                                 swt(j)=swts(j1)*swts(j2);	       end    endend % For 20-node brick element volume integrationif(meltyp==20)          nqptv=27;            qpt(1)=0.1127016653793;                                                 qpt(2)=0.50;                                                            qpt(3)=1.0-qpts(1);                                                      wts(1)=0.5555555555556/2.;                                               wts(2)=0.8888888888889/2.;      % Line 203 corrected!      wts(3)=wts(1);             j1v = zeros(nqptv);      j2v = zeros(nqptv);      j3v = zeros(nqptv);      ic = 0;      for i=1:3          for j=1:3              for k = 1:3                  ic = ic+1;                  j1v(ic) = i;                  j2v(ic) = j;                  j3v(ic) = k;              end          end      end            dndxi = zeros(nnpe,nqptv);      dndet = zeros(nnpe,nqptv);      dndze = zeros(nnpe,nqptv);      sfac  = zeros(nnpe,nqptv);      wtq = zeros(nqptv,1);                                                 for i=1:1:nnpe                                                        for  j=1:1:nqptv                   j1 = j1v(j);         j2 = j2v(j);         j3 = j3v(j);               q1=qpt(j1);                                                             q2=qpt(j2);                                                              q3=qpt(j3);                                                            sfac(i,j) =sfn3d(q1,q2,q3,i,meltyp);                                                  dndxi(i,j)=fxi3d(q1,q2,q3,i,meltyp);                                                 dndet(i,j)=fet3d(q1,q2,q3,i,meltyp);                                                 dndze(i,j)=fze3d(q1,q2,q3,i,meltyp);                                                 wtq(j)=wts(j1)*wts(j2)*wts(j3);      end   end  end % For 27-node brick element surface integrationif(meltyp==27)      nqpts=9;      qpts(1)=0.1127016653793;                                                 qpts(2)=0.50;                                                            qpts(3)=1.0-qpts(1);                                                      swts(1)=0.5555555555556/2.;                                               swts(2)=0.8888888888889/2.;                                          swts(3)=swts(1);             j1s = zeros(nqpts);      j2s = zeros(nqpts);      ic = 0;            for i=1:3          for j=1:3              ic = ic+1;              j1s(ic) = i;              j2s(ic) = j;          end      end	     for  i=1:1:nnps                                                        for  j=1:1:nqpts		 	     j1 = j1s(j);         j2 = j2s(j);                                                        q1=qpts(j1);                                                              q2=qpts(j2);                                                              ssfac(i,j)=sfn(q1,q2,i,meltyp);                                                  dnda(i,j)=fxi(q1,q2,i,meltyp);                                                 dndb(i,j)=fet(q1,q2,i,meltyp);                                                 swt(j)=swts(j1)*swts(j2);     end    endend % For 27-node brick element volume integrationif(meltyp==27)          nqptv=27;      qpt(1)=0.1127016653793;                                                 qpt(2)=0.50;                                                            qpt(3)=1.0-qpts(1);                                                      wts(1)=0.5555555555556/2.;                                               wts(2)=0.8888888888889/2.;                                               wts(3)=wts(1);             j1v = zeros(nqptv);      j2v = zeros(nqptv);      j3v = zeros(nqptv);      ic = 0;      for i=1:3          for j=1:3              for k = 1:3                  ic = ic+1;                  j1v(ic) = i;                  j2v(ic) = j;                  j3v(ic) = k;              end          end      end            dndxi = zeros(nnpe,nqptv);      dndet = zeros(nnpe,nqptv);      dndze = zeros(nnpe,nqptv);      sfac  = zeros(nnpe,nqptv);      wtq = zeros(nqptv,1);                                                 for i=1:1:nnpe                                                        for  j=1:1:nqptv                   j1 = j1v(j);         j2 = j2v(j);         j3 = j3v(j);               q1=qpt(j1);                                                             q2=qpt(j2);                                                              q3=qpt(j3);                                                            sfac(i,j) =sfn3d(q1,q2,q3,i,meltyp);                                                  dndxi(i,j)=fxi3d(q1,q2,q3,i,meltyp);                                                 dndet(i,j)=fet3d(q1,q2,q3,i,meltyp);                                                 dndze(i,j)=fze3d(q1,q2,q3,i,meltyp);                                                 wtq(j)=wts(j1)*wts(j2)*wts(j3);      end   end  end