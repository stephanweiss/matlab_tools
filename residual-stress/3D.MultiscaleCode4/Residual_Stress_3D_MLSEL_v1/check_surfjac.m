% Surface jacobian check
clear
close
clc

% Nodal coords

% 8 node brick element check
x(1)=0;       y(1)=0;       z(1)=0;
x(2)=1;       y(2)=0;       z(2)=0;
x(3)=1;       y(3)=2;       z(3)=0;
x(4)=0;       y(4)=1;       z(4)=0;

x(5)=0;       y(5)=0;       z(5)=0.5;
x(6)=1;       y(6)=0;       z(6)=0.5;
x(7)=1;       y(7)=2;       z(7)=0.5;
x(8)=0;       y(8)=1;       z(8)=0.5;


numels=6;
nnpe=8;
nnps=4;
meltyp=8;
nps(1,1) = 1 ;
nps(1,2) = 5 ;
nps(1,3) = 8 ;
nps(1,4) = 4 ;
nps(2,1) = 2 ;
nps(2,2) = 3 ;
nps(2,3) = 7 ;
nps(2,4) = 6 ;
nps(3,1) = 1 ;
nps(3,2) = 2 ;
nps(3,3) = 6 ;
nps(3,4) = 5 ;
nps(4,1) = 3 ;
nps(4,2) = 4 ;
nps(4,3) = 8 ;
nps(4,4) = 7 ;
nps(5,1) = 1 ;
nps(5,2) = 4 ;
nps(5,3) = 3 ;
nps(5,4) = 2 ;
nps(6,1) = 5 ;
nps(6,2) = 6 ;
nps(6,3) = 7 ;
nps(6,4) = 8 ;

% % 20 node brick element check
% % Nodal coordinates
% x(1)=0;y(1)=0;z(1)=0;
% x(2)=1;y(2)=0;z(2)=0;
% x(3)=1;y(3)=2;z(3)=0;
% x(4)=0;y(4)=1;z(4)=0;
% x(5)=0;y(5)=0;z(5)=0.5;
% x(6)=1;y(6)=0;z(6)=0.5;
% x(7)=1;y(7)=2;z(7)=0.5;
% x(8)=0;y(8)=1;z(8)=0.5;
% x(9)=0.5;y(9)=0;z(9)=0;
% x(10)=1;y(10)=1;z(10)=0;
% x(11)=0.5;y(11)=1.5;z(11)=0;
% x(12)=0;y(12)=0.5;z(12)=0;
% x(13)=0.5;y(13)=0;z(13)=0.5;
% x(14)=1;y(14)=1;z(14)=0.5;
% x(15)=0.5;y(15)=1.5;z(15)=0.5;
% x(16)=0;y(16)=0.5;z(16)=0.5;
% x(17)=0;y(17)=0;z(17)=0.25;
% x(18)=1;y(18)=0;z(18)=0.25;
% x(19)=1;y(19)=2;z(19)=0.25;
% x(20)=0;y(20)=1;z(20)=0.25;
% numels=6;
% nnpe=20;
% nnps=8;
% meltyp=20;
% 
% % Nodes defining the surface
% 
% nps(1,1) = 1 ;
% nps(1,2) = 17 ;
% nps(1,3) = 5 ;
% nps(1,4) = 16 ;
% nps(1,5) = 8 ;
% nps(1,6) = 20 ;
% nps(1,7) = 4 ;
% nps(1,8) = 12 ;
% 
% nps(2,1) = 2 ;
% nps(2,2) = 10 ;
% nps(2,3) = 3 ;
% nps(2,4) = 19 ;
% nps(2,5) = 7 ;
% nps(2,6) = 14 ;
% nps(2,7) = 6 ;
% nps(2,8) = 18 ;
% 
% nps(3,1) = 1 ;
% nps(3,2) = 9 ;
% nps(3,3) = 2 ;
% nps(3,4) = 18 ;
% nps(3,5) = 6 ;
% nps(3,6) = 13 ;
% nps(3,7) = 5 ;
% nps(3,8) = 17 ;
% 
% nps(4,1) = 3 ;
% nps(4,2) = 11 ;
% nps(4,3) = 4 ;
% nps(4,4) = 20 ;
% nps(4,5) = 8 ;
% nps(4,6) = 15 ;
% nps(4,7) = 7 ;
% nps(4,8) = 19 ;
% 
% nps(5,1) = 1 ;
% nps(5,2) = 12 ;
% nps(5,3) = 4 ;
% nps(5,4) = 11 ;
% nps(5,5) = 3 ;
% nps(5,6) = 10 ;
% nps(5,7) = 2 ;
% nps(5,8) = 9 ;    
% 
% nps(6,1) = 5 ;
% nps(6,2) = 13 ;
% nps(6,3) = 6 ;
% nps(6,4) = 14 ;
% nps(6,5) = 7 ;
% nps(6,6) = 15 ;
% nps(6,7) = 8 ;
% nps(6,8) = 16 ;


% % 27 node element
% numels=6;
% nnpe=27;
% nnps=9;
% meltyp=27;
% 
% % Nodal coordinates
% x(1)=0;y(1)=0;z(1)=0;
% x(2)=1;y(2)=0;z(2)=0;
% x(3)=1;y(3)=2;z(3)=0;
% x(4)=0;y(4)=1;z(4)=0;
% x(5)=0;y(5)=0;z(5)=0.5;
% x(6)=1;y(6)=0;z(6)=0.5;
% x(7)=1;y(7)=2;z(7)=0.5;
% x(8)=0;y(8)=1;z(8)=0.5;
% x(9)=0.5;y(9)=0;z(9)=0;
% x(10)=1;y(10)=1;z(10)=0;
% x(11)=0.5;y(11)=1.5;z(11)=0;
% x(12)=0;y(12)=0.5;z(12)=0;
% x(13)=0.5;y(13)=0;z(13)=0.5;
% x(14)=1;y(14)=1;z(14)=0.5;
% x(15)=0.5;y(15)=1.5;z(15)=0.5;
% x(16)=0;y(16)=0.5;z(16)=0.5;
% x(17)=0;y(17)=0;z(17)=0.25;
% x(18)=1;y(18)=0;z(18)=0.25;
% x(19)=1;y(19)=2;z(19)=0.25;
% x(20)=0;y(20)=1;z(20)=0.25;
% x(21)=0;y(21)=0.5;z(21)=0.25;
% x(22)=1;y(22)=1;z(22)=0.25;
% x(23)=0.5;y(23)=1.5;z(23)=0.25;
% x(24)=0.5;y(24)=0;z(24)=0.25;
% x(25)=0.5;y(25)=0.75;z(25)=0;
% x(26)=0.5;y(26)=0.75;z(26)=0.5;
% x(27)=0.5;y(27)=0.75;z(27)=0.25;
% 
% 
% % Nodes defining the surface
% nps(3,1) = 1 ;
% nps(3,2) = 9 ;
% nps(3,3) = 2 ;
% nps(3,4) = 18 ;
% nps(3,5) = 6 ;
% nps(3,6) = 13 ;
% nps(3,7) = 5 ;
% nps(3,8) = 17 ;
% nps(3,9) = 24 ;
% 
% nps(4,1) = 3 ;
% nps(4,2) = 11 ;
% nps(4,3) = 4 ;
% nps(4,4) = 20 ;
% nps(4,5) = 8 ;
% nps(4,6) = 15 ;
% nps(4,7) = 7 ;
% nps(4,8) = 19 ;
% nps(4,9) = 23 ;
% 
% nps(1,1) = 1 ;
% nps(1,2) = 17 ;
% nps(1,3) = 5 ;
% nps(1,4) = 16 ;
% nps(1,5) = 8 ;
% nps(1,6) = 20 ;
% nps(1,7) = 4 ;
% nps(1,8) = 12 ;
% nps(1,9) = 21 ;
% 
% nps(2,1) = 2 ;
% nps(2,2) = 10 ;
% nps(2,3) = 3 ;
% nps(2,4) = 19 ;
% nps(2,5) = 7 ;
% nps(2,6) = 14 ;
% nps(2,7) = 6 ;
% nps(2,8) = 18 ;
% nps(2,9) = 22 ;
% 
% nps(5,1) = 1 ;
% nps(5,2) = 12 ;
% nps(5,3) = 4 ;
% nps(5,4) = 11 ;
% nps(5,5) = 3 ;
% nps(5,6) = 10 ;
% nps(5,7) = 2 ;
% nps(5,8) = 9 ;
% nps(5,9) = 25 ;
% 
% nps(6,1) = 5 ;
% nps(6,2) = 13 ;
% nps(6,3) = 6 ;
% nps(6,4) = 14 ;
% nps(6,5) = 7 ;
% nps(6,6) = 15 ;
% nps(6,7) = 8 ;
% nps(6,8) = 16 ;
% nps(6,9) = 26 ;

[nqptv,wtq,sfac,dndxi,dndet,dndze,nqpts,swt,ssfac,dnda,dndb] = shafac(meltyp,nnpe,nnps);

for i=1:numels
    % for all quad points
    [n rjs] = surfjac(i,nnps,nqpts,dnda,dndb,nps,x,y,z);
    % take only 1 of them
    surfnormal(i,:)=n(1,:);
    surfnormal(i,:)=n(1,:);
    sum=0;
    for j=1:nqpts
        sum=sum+rjs(j)*swt(j);
    end
    totsurfjac(i)=sum;
end

% Output
figure
hold on
plot3(x,y,z,'bo')










