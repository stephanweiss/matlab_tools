function fe = elforc_residual(nnpe,nqptv,wtq,sfac,detj,crystal_stress)% computes elemental force matrix for body forcesndofnp = 6;iend1 =   nnpe*ndofnp;sfac_sig       = zeros(1,nnpe);sfac_onedof    = zeros(1,nnpe);sfac_sixdof    = zeros(ndofnp,iend1);qp_stress      = zeros(ndofnp,1);fe      = zeros(iend1,1);                                                               for   k=1:1:nqptv           xkfac= wtq(k)*detj(k);       qp_stress(1) = crystal_stress(1,k);       qp_stress(2) = crystal_stress(2,k);       qp_stress(3) = crystal_stress(3,k);       qp_stress(4) = crystal_stress(4,k);       qp_stress(5) = crystal_stress(5,k);       qp_stress(6) = crystal_stress(6,k);                                                                          for  i=1:1:nnpe       sfac_onedof(i)  = sfac(i,k);  end    for  i=1:1:ndofnp       for j = 1:1:nnpe          j1=(i-1)*nnpe+j;       sfac_sixdof(i,j1)  = sfac_onedof(j);      end  end       fe       = fe  + xkfac*sfac_sixdof'*qp_stress;   end