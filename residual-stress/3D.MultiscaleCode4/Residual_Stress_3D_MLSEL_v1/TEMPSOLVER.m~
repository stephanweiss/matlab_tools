clear all
close all
clc

% load('TEMP.K.Q.mat')
% load('/home/jspark/Documents/work/prjResidualStress/2D.Code.JSP/TEMP.A.N.mat')
%
% Fvec    = [zeros(2028,1); Fvec];
% LHS     = sparse([K -Q*BigNMat; zeros(39744,2028) BigA]);
% clear K Q BigNMat BigA
%
% SH  = LHS\Fvec;
% clear LHS Fvec
%
% load meshdata.mat
% save('temp.answer.mat')
load('temp.answer.mat')

S   = SH(1:2028,1);
S   = reshape(S,6,338);

max_S   = max(max(S));
min_S   = min(min(S));

S11 = S(1,:);
S22 = S(2,:);
S33 = S(3,:);
S12 = S(4,:);
S13 = S(5,:);
S23 = S(6,:);

SEFF    = sqrt(((S11 - S22).^2 + (S22 - S33).^2 + (S33 - S11).^2 + ...
    6*S12.*S12 + 6*S13.*S13 + 6*S23.*S23)./2);

ncmap   = 256;
cmap    = jet(ncmap);
dData   = max_S - min_S;
c11 = round((ncmap-1)*(S11 - min_S)./dData) + 1;
c22 = round((ncmap-1)*(S22 - min_S)./dData) + 1;
c33 = round((ncmap-1)*(S33 - min_S)./dData) + 1;
c12 = round((ncmap-1)*(S12 - min_S)./dData) + 1;
c13 = round((ncmap-1)*(S13 - min_S)./dData) + 1;
c23 = round((ncmap-1)*(S23 - min_S)./dData) + 1;
cVM = round((ncmap-1)*(SEFF - min_S)./dData) + 1;

figure(1)
c   = c23;
title('\Sigma_{13}')
view([90 0])
for i=1:numel
    Node1=np(i,1);
    Node2=np(i,2);
    Node3=np(i,3);
    Node4=np(i,4);
    Node5=np(i,5);
    Node6=np(i,6);
    Node7=np(i,7);
    Node8=np(i,8);
    
    xx  = [x(Node1) x(Node2) x(Node3) x(Node4)...
        x(Node5) x(Node6) x(Node7) x(Node8)];
    yy  =[y(Node1) y(Node2) y(Node3) y(Node4)...
        y(Node5) y(Node6) y(Node7) y(Node8)];
    zz  =[z(Node1) z(Node2) z(Node3) z(Node4)...
        z(Node5) z(Node6) z(Node7) z(Node8)];
    
    line([xx(1:4) xx(1)],[yy(1:4) yy(1)],[zz(1:4) zz(1)],'Color','k');
    line([xx(5:8) xx(5)],[yy(5:8) yy(5)],[zz(5:8) zz(5)],'Color','k');
    line([xx(1) xx(5)],[yy(1) yy(5)],[zz(1) zz(5)],'Color','k');
    line([xx(2) xx(6)],[yy(2) yy(6)],[zz(2) zz(6)],'Color','k');
    line([xx(3) xx(7)],[yy(3) yy(7)],[zz(3) zz(7)],'Color','k');
    line([xx(4) xx(8)],[yy(4) yy(8)],[zz(4) zz(8)],'Color','k');
    hold on
    
    xx  = [x(Node1) x(Node2) x(Node6) x(Node5)]';
    yy  = [y(Node1) y(Node2) y(Node6) y(Node5)]';
    zz  = [z(Node1) z(Node2) z(Node6) z(Node5)]';
    cc  = [c(Node1) c(Node2) c(Node6) c(Node5)]';
    
    p   = patch(xx, yy, zz, mean(cmap(cc,:),1));
    set(p, 'FaceColor', 'interp',...
        'FaceVertexCData', cmap(cc,:))
end
caxis([min_S max_S])
colorbar horz
axis equal tight